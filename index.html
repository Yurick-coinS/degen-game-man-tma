<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>DEGEN-MAN: Brawl Edition</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');

    :root {
      --board-size: 94vw;
      --max-board: 420px;
      --neon: #9945FF;
      --neon-green: #14F195;
    }

    body {
      margin: 0;
      padding: 0;
      background: #0f0f1a;
      color: #fff;
      font-family: 'Share Tech Mono', monospace;
      overflow: hidden;
      touch-action: none
    }

    #game-wrapper {
      position: relative;
      width: 100vw;
      height: 100vh;
      overflow: hidden
    }

    #game-canvas {
      position: absolute;
      top: 0;
      left: 0;
      background: #000;
      border: 2px solid var(--neon);
      box-shadow: 0 0 20px var(--neon)
    }

    #ui-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 999
    }

    #score-panel {
      position: absolute;
      top: 8px;
      left: 8px;
      color: var(--neon-green);
      font-size: 1.1rem;
      text-shadow: 0 0 8px var(--neon-green)
    }

    #lives-panel {
      position: absolute;
      top: 8px;
      right: 8px;
      color: var(--neon-green);
      font-size: 1.1rem;
      text-shadow: 0 0 8px var(--neon-green)
    }

    #joystick-base,
    #joystick-stick {
      position: absolute;
      border-radius: 50%;
      user-select: none;
      touch-action: none
    }

    #joystick-base {
      width: 120px;
      height: 120px;
      background: rgba(153, 69, 255, .25);
      border: 3px solid var(--neon);
      bottom: 20px;
      left: 20px
    }

    #joystick-stick {
      width: 40px;
      height: 40px;
      background: var(--neon-green);
      border: 3px solid #fff;
      top: 40px;
      left: 40px;
      transition: none
    }

    #abtn {
      position: absolute;
      width: 90px;
      height: 90px;
      background: #e74c3c;
      border-radius: 50%;
      border: 4px solid #fff;
      bottom: 20px;
      right: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      color: #fff;
      box-shadow: 0 2px 16px #e74c3c88
    }

    #abtn.active {
      background: #c0392b
    }

    .sprite {
      position: absolute;
      background: url('assets/sprites/player_sprites.png') no-repeat;
      background-size: cover
    }

    .player {
      width: 32px;
      height: 32px
    }

    /* Brawl-Stars size */
    .wall {
      background: #14F195;
      border-radius: 4px
    }

    .candle {
      width: 12px;
      height: 12px;
      background: #FFD700;
      border-radius: 50%;
      box-shadow: 0 0 8px #FFD700
    }
  </style>
</head>

<body>
  <div id="game-wrapper">
    <canvas id="game-canvas"></canvas>
    <div id="ui-overlay">
      <div id="score-panel">$POOR: <span id="score">0</span></div>
      <div id="lives-panel">LIVES: <span id="lives">3</span></div>
      <div id="joystick-base">
        <div id="joystick-stick"></div>
      </div>
      <div id="abtn">A</div>
    </div>
  </div>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    /* ---------- CONFIG ---------- */
    const TILE = 64;                 // wide tile size
    const MAP_W = 40, MAP_H = 30;    // spacious map
    const PLAYER_SPEED = 3;
    /* ---------- CANVAS & CONTEXT ---------- */
    const canvas = document.getElementById('game-canvas');
    const ctx = canvas.getContext('2d');
    function resize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();
    /* ---------- CAMERA ---------- */
    const camera = { x: 0, y: 0 };
    function updateCamera(px, py) {
      camera.x = px - canvas.width / 2;
      camera.y = py - canvas.height / 2;
    }
    /* ---------- PLAYER ---------- */
    const player = { x: TILE * 2, y: TILE * 2, w: 32, h: 32, dir: { x: 0, y: 0 } };
    /* ---------- MAP ---------- */
    const map = Array.from({ length: MAP_H }, () => Array(MAP_W).fill(0));
    // simple wide corridors
    for (let r = 0; r < MAP_H; r++) {
      map[r][0] = 1; map[r][MAP_W - 1] = 1;
    }
    for (let c = 0; c < MAP_W; c++) {
      map[0][c] = 1; map[MAP_H - 1][c] = 1;
    }
    for (let r = 3; r < MAP_H - 3; r++) {
      for (let c = 3; c < MAP_W - 3; c++) {
        if (r % 6 === 0 || c % 6 === 0) map[r][c] = 1;
      }
    }
    /* ---------- CANDLES ---------- */
    const candles = [];
    for (let i = 0; i < 60; i++) {
      let x, y;
      do { x = Math.floor(Math.random() * MAP_W); y = Math.floor(Math.random() * MAP_H); }
      while (map[y][x] === 1);
      candles.push({ x: x * TILE + TILE / 2, y: y * TILE + TILE / 2 });
    }
    /* ---------- INPUT ---------- */
    const keys = {};
    window.addEventListener('keydown', e => keys[e.code] = true);
    window.addEventListener('keyup', e => keys[e.code] = false);
    let joystick = { dx: 0, dy: 0 };
    function initJoystick() {
      const base = document.getElementById('joystick-base');
      const stick = document.getElementById('joystick-stick');
      let tid = null;
      base.addEventListener('touchstart', e => {
        tid = e.touches[0].identifier;
        move(e.touches[0]);
      });
      window.addEventListener('touchmove', e => {
        for (const t of e.changedTouches) if (t.identifier === tid) move(t);
      });
      window.addEventListener('touchend', e => {
        for (const t of e.changedTouches) if (t.identifier === tid) { tid = null; joystick.dx = 0; joystick.dy = 0; stick.style.transform = 'translate(0px,0px)'; }
      });
      function move(t) {
        const rect = base.getBoundingClientRect();
        const cx = rect.left + rect.width / 2;
        const cy = rect.top + rect.height / 2;
        let dx = t.clientX - cx;
        let dy = t.clientY - cy;
        const dist = Math.min(40, Math.sqrt(dx * dx + dy * dy));
        const ang = Math.atan2(dy, dx);
        dx = Math.cos(ang) * dist;
        dy = Math.sin(ang) * dist;
        stick.style.transform = `translate(${dx}px,${dy}px)`;
        joystick.dx = dx / 40;
        joystick.dy = dy / 40;
      }
    }
    initJoystick();
    /* ---------- GAME LOOP ---------- */
    let score = 0, lives = 3;
    function gameLoop() {
      /* direction */
      player.dir.x = (keys['KeyD'] ? 1 : 0) - (keys['KeyA'] ? 1 : 0) + joystick.dx;
      player.dir.y = (keys['KeyS'] ? 1 : 0) - (keys['KeyW'] ? 1 : 0) + joystick.dy;
      const len = Math.hypot(player.dir.x, player.dir.y);
      if (len > 0) { player.dir.x /= len; player.dir.y /= len; }
      /* move */
      const nx = player.x + player.dir.x * PLAYER_SPEED;
      const ny = player.y + player.dir.y * PLAYER_SPEED;
      const gx = Math.floor(nx / TILE), gy = Math.floor(ny / TILE);
      if (map[gy]?.[gx] !== 1) { player.x = nx; player.y = ny; }
      /* camera */
      updateCamera(player.x + player.w / 2, player.y + player.h / 2);
      /* draw */
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.save();
      ctx.translate(-camera.x, -camera.y);
      /* walls */
      ctx.fillStyle = '#14F195';
      for (let r = 0; r < MAP_H; r++) {
        for (let c = 0; c < MAP_W; c++) {
          if (map[r][c] === 1) {
            ctx.fillRect(c * TILE, r * TILE, TILE, TILE);
          }
        }
      }
      /* candles */
      ctx.fillStyle = '#FFD700';
      candles.forEach((c, i) => {
        ctx.beginPath();
        ctx.arc(c.x, c.y, 6, 0, Math.PI * 2);
        ctx.fill();
        /* collection */
        const dx = c.x - (player.x + player.w / 2);
        const dy = c.y - (player.y + player.h / 2);
        if (Math.hypot(dx, dy) < 20) {
          candles.splice(i, 1);
          score += 10;
          document.getElementById('score').textContent = score;
        }
      });
      /* player */
      ctx.fillStyle = '#FFD6A5';
      ctx.fillRect(player.x, player.y, player.w, player.h);
      ctx.restore();
      requestAnimationFrame(gameLoop);
    }
    /* ---------- START ---------- */
    gameLoop();
  </script>
</body>

</html>